<html>

<head>
	<title>Test Event Model</title>
</head>

<body>
	<form>
		<fieldset>
			<legend>Info</legend>
			<label for="fname">First Name</label>
			<input name="fname" required />

			<label for="lname">Last Name</label>
			<input name="lname" required />

			<label for="email">Email</label>
			<input name="email" type="email" required />

			<progress max="1" value="0" />
		</fieldset>
		<fieldset>
			<legend>Additional Info</legend>

			<label for="comment">Comment</label>
			<input name="comment" required />

			<label for="date">Date</label>
			<input name="date" type="date" required />

			<progress max="1" value="0" />
		</fieldset>
		<button>Submit</button>
	</form>

	<script src="eventmodel.js"></script>
	<script>
		var model = new EventModel({
			"fieldset": new EventModel({
				"[required]": {
					change: function(e, model) { model.update(); },
					valid: function() { return this.validity.valid; }
				},
				"progress": {
					update: function(e, model) {
						var valid = model.valid();
						this.max = valid.length;
						this.value = valid.reduce(function (t, x) { return x ? t + 1 : t });
					}
				}
			}),
			"input": {
				data: function(e) {
					e.data[this.name] = this.value;
				}
			},
			"form": {
				submit: function(e, model) {
					var result = {};
					model.data(result);
					document.write(JSON.stringify(result));
					e.preventDefault();
				}
			}
		});
		model.bind();
	</script>
</body>

</html>