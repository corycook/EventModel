<html>

<head>
	<title>Test Event Model</title>
	<script src="eventmodel.js"></script>
	<style>
		th {
			cursor: pointer;
		}
		
		.asc::after {
			content: '\25BD';
		}
		
		.desc::after {
			content: '\25B3';
		}
	</style>
</head>

<body>

	<p>Click on a header to sort the column. Click a cell to edit the contents.</p>

	<table>
		<thead>
			<tr>
				<th>Id</th>
				<th>Name</th>
				<th>Value</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>0</td>
				<td>Testing</td>
				<td>Framework</td>
			</tr>
			<tr>
				<td>1</td>
				<td>Apple</td>
				<td>Simple</td>
			</tr>
			<tr>
				<td>2</td>
				<td>Banana</td>
				<td>Complex</td>
			</tr>
		</tbody>
		<tfoot>
			<tr>
				<td></td>
				<td></td>
				<td>
					<button>Add</button>
				</td>
			</tr>
		</tfoot>
		<template>
			<tr>
				<td>Item</td>
				<td>Item</td>
				<td>Item</td>
			</tr>
		</template>
	</table>

	<script>
		var m = new EventModel({
			'table': new EventModel({
				'tbody': {
					sort: function(e, model) {
						var sorted = Array.prototype.slice.call(this.children).sort(function(a, b) {
							return (a.children[e.data[0]].textContent < b.children[e.data[0]].textContent ? -1 : 1) * e.data[1];
						});
						for (var i in sorted) this.appendChild(sorted[i]);
					},
					addrow: function(event, model) {
						this.appendChild(event.data);
					}
				},
				'thead tr': {
					click: function(e, model) {
						if (e.target == this) return;
						var ix = Array.prototype.slice.call(this.children).indexOf(e.target);
						var dir = e.target.classList.contains('asc') ? -1 : 1;
						model.clear();
						model.sort([ix, dir]);
						e.target.classList.add(dir == 1 ? 'asc' : 'desc');
					}
				},
				'th': {
					clear: function(e, model) { 
						this.classList.remove('asc');
						this.classList.remove('desc'); 
					}
				},
				'tbody;tr': new EventModel({
					'td': {
						click: function() {
							var input = document.createElement('input');
							input.value = this.textContent;
							this.textContent = null;
							this.appendChild(input);
							input.focus();
							input.setSelectionRange(0, input.value.length);
						}
					},
					'base;input': {
						blur: function(e, model) { this.parentElement.innerHTML = this.value; },
						keyup: function(e) { if (e.keyCode == 13) this.blur(); }
					}
				}),
				'button': {
					click: function(event, model) {
						model.addrow(model.newrow()[0]);
					}
				},
				'template': {
					newrow: function() {
						return this.content.cloneNode(true);
					}
				}
			})
		});
		m.bind();
	</script>
</body>

</html>